{% include header.html %}
{{ content }}
<div id="mymap"></div>
{% assign fiches = site.categories.fiches | sort : "order" %}
{% assign destinations = site.categories.destinations | sort : "order" %}
{% assign destination_limit = site.data.config.items[0].items_liste_partielle %}
{% for destination in destinations %}
  {% include destination.html %}
{% endfor %}
{% capture extrajs %}
<script src="https://unpkg.com/leaflet@1.7.1/dist/leaflet.js"
   integrity="sha512-XQoYMqMTK8LvdxXYG3nZ448hOEQiglfqkJs1NOQV44cWnUrBc8PkAOcXy20w0vlaXaVUearIOBhiXZ5V3ynxwA=="
   crossorigin=""></script>
   <script src="https://unpkg.com/leaflet.markercluster@1.4.1/dist/leaflet.markercluster.js"></script>
<script src="/libraries/leaflet/my_leaflet.js?token={{ site.time | date: '%s' }}"></script>
<script>
  var mymap = L.map('mymap');
  L.tileLayer('https://api.mapbox.com/styles/v1/{id}/tiles/{z}/{x}/{y}?access_token={{ site.data.config.api.mapbox }}', {
    maxZoom: 18,
    attribution: 'Map data &copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors, ' +
      'Imagery Â© <a href="https://www.mapbox.com/">Mapbox</a>',
    id: 'mapbox/streets-v11',
    tileSize: 512,
    zoomOffset: -1
  }).addTo(mymap);

  var markers = [];
  var singlemarkers = L.markerClusterGroup();
  {% for destination in destinations %}
    {% if destination.latlon.size == 0%}
      {% comment %}
        No latitude longitude, moving on.
      {% endcomment %}
    {% elsif destination.latlon.size == 1%}
      var marker = L.marker([{{ destination.latlon[0].lat }}, {{ destination.latlon[0].lon }}]);
      markers.push(marker);
      singlemarkers.addLayer(marker);
    {% else %}
      var mypolygon = [];
      {% for latlon in destination.latlon %}
        var marker = L.marker([{{ latlon.lat }}, {{ latlon.lon }}]);
        mypolygon.push([{{ latlon.lat }}, {{ latlon.lon }}]);
        markers.push(marker);
      {% endfor %}
      var polygon = L.polygon(mypolygon).addTo(mymap);
    {% endif %}
  {% endfor %}

  var group = new L.featureGroup(markers);

  mymap.addLayer(singlemarkers);

  mymap.fitBounds(group.getBounds());
</script>
{% endcapture %}
{% include footer.html %}
